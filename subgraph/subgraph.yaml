specVersion: 0.0.5
schema:
  file: ./schema.graphql

dataSources:
  # BookNFT Contract
  - kind: ethereum/contract
    name: BookNFT
    network: localhost
    source:
      address: "0x5FbDB2315678afecb367f032d93F642f64180aa3"
      abi: BookNFT
      startBlock: 0
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Book
        - User
        - Transaction
        - Event
        - GlobalStats
      abis:
        - name: BookNFT
          file: ./abis/BookNFT.json
      eventHandlers:
        - event: BookMinted(indexed uint256,string,uint8,uint8)
          handler: handleBookMinted
        - event: BookStatusUpdated(indexed uint256,uint8,uint8)
          handler: handleBookStatusUpdated
        - event: ConditionUpdated(indexed uint256,uint8,uint8)
          handler: handleConditionUpdated
        - event: BookImageUpdated(indexed uint256,string,string)
          handler: handleBookImageUpdated
        - event: BookInfoUpdated(indexed uint256,string,string)
          handler: handleBookInfoUpdated
        - event: Transfer(indexed address,indexed address,indexed uint256)
          handler: handleTransfer
      file: ./src/book-nft.ts

  # LibraryCore Contract
  - kind: ethereum/contract
    name: LibraryCore
    network: localhost
    source:
      address: "0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512"
      abi: LibraryCore
      startBlock: 0
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Loan
        - User
        - Book
        - Transaction
        - Event
        - DailyStats
        - GlobalStats
      abis:
        - name: LibraryCore
          file: ./abis/LibraryCore.json
        - name: BookNFT
          file: ./abis/BookNFT.json
      eventHandlers:
        - event: BookBorrowed(indexed address,indexed uint256,uint256,uint256)
          handler: handleBookBorrowed
        - event: BookReturned(indexed address,indexed uint256,uint256,int256,string)
          handler: handleBookReturned
        - event: LoanExtended(indexed uint256,indexed address,uint256)
          handler: handleLoanExtended
        - event: BookReserved(indexed uint256,indexed address)
          handler: handleBookReserved
        - event: BookAvailableForReservation(indexed uint256,indexed address)
          handler: handleBookAvailableForReservation
        - event: PenaltyWithdrawn(indexed address,uint256)
          handler: handlePenaltyWithdrawn
      file: ./src/library-core.ts
